<!-- Container-fluid starts-->
<div class="container-fluid">
  <div class="card">
    <div class="card-header">
      <h5>Agregar Producto</h5>
    </div>
    <div class="card-body">
      <form class="needs-validation" [formGroup]="productoForm" (ngSubmit)="onSubmit()" novalidate>
        <!-- Paso 1 -->
        <div *ngIf="currentStep === 1">
          <h4>Paso 1: Seleccionar Sección, Categoría y Subcategoría</h4>

          <div class="add-product-form">
            <div class="form-group row">
              <label class="col-xl-3 col-md-4">Sección:</label>
              <div class="col-md-7">
                <select class="custom-select form-select" formControlName="seccion"
                  (change)="onSectionChange(); onSectionChangeCategoria()">
                  <option value="" disabled selected>Seleccione una Sección</option>
                  <option *ngFor="let seccion of seccionDto" value="{{seccion.secc_id}}">{{seccion.secc_nombre}}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div class="add-product-form">
            <div class="form-group row">
              <label class="col-xl-3 col-md-4">Categoría:</label>
              <div class="col-md-7">
                <select class="custom-select form-select" formControlName="categoria">
                  <option value="" disabled selected>Seleccione una Categoria</option>
                  <option *ngFor="let categoria of categoriaDto" value="{{categoria.cat_id}}">{{categoria.cat_nombre}}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div class="add-product-form">
            <div class="form-group row">
              <label class="col-xl-3 col-md-4">Subcategoría:</label>
              <div class="col-md-7">
                <select class="custom-select form-select" formControlName="subcategoria">
                  <option value="">--Selecciona la subcategoría--</option>
                  <option value="subcat1">Subcategoría 1</option>
                  <option value="subcat2">Subcategoría 2</option>
                  <!-- Agrega más subcategorías según necesites -->
                </select>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-primary" (click)="goToNextStep()">Siguiente</button>
          </div>
        </div>

        <!-- Paso 2 -->
        <div *ngIf="currentStep === 2">
          <h4>Paso 2: Detalles de Talla y Color</h4>
          <div *ngIf="isRopaOrZapatos" class="add-product-form">
            <div formArrayName="tallas">
              <div *ngFor="let talla of tallas.controls; let i = index" [formGroupName]="i"
                class="form-group row align-items-center mb-2">
                <label class="col-md-3 col-form-label">Talla {{ i + 1 }}:</label>
                <div class="col-md-6">
                  <input class="form-control" formControlName="talla" type="text" required placeholder="Ej: 38 o XS">
                </div>
                <div class="col-md-2">
                  <button type="button" class="btn btn-danger" (click)="removeTalla(i)"><i
                      class="fa fa-trash-o"></i></button>
                </div>
              </div>
              <button type="button" class="btn btn-secondary mb-2" (click)="addTalla()">Agregar Talla</button>
            </div>
          </div>

          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" (click)="goToPreviousStep()">Anterior</button>
            <button type="button" class="btn btn-primary" (click)="goToNextStep()">Siguiente</button>
          </div>
        </div>

        <!-- Paso 3 -->
        <div *ngIf="currentStep === 3">
          <h4>Paso 3: Subir Imágenes y Detalles Finales</h4>

          <div class="file-upload-container">
            <label for="file-upload" class="file-upload-button">
              <i class="fa fa-cloud-upload"></i> Seleccionar Fotos del Producto
            </label>
            <input id="file-upload" type="file" style="display:none;" (change)="onFileSelected($event)" multiple>
            <div class="file-upload-instructions">
              Sube tu imagen en formato JPEG, PNG o WEBP con una resolución mínima de 5000 píxeles en ambos lados y un
              peso máximo de 10 MB.
            </div>
          </div>

          <div class="form-group row m-2">
            <div class="col-md-7 offset-md-4 d-flex flex-wrap">
              <div *ngFor="let foto of fotos; let i = index" class="position-relative m-3">
                <img [src]="foto" alt="Foto {{i + 1}}" class="img-thumbnail" style="width: 60px; height: 60px;">
                <span *ngIf="i === 0" class="badge badge-primary position-absolute"
                  style="bottom: 0; left: 0;">Portada</span>
                <button type="button" class="btn btn-danger btn-sm position-absolute p-0 eliminar-foto"
                  (click)="removeFoto(i)">X</button>
              </div>
            </div>
          </div>

          <div *ngIf="isRopaOrZapatos" class="add-product-form">
            <div formArrayName="variantes">
              <div class="form-group row">
                <div class="col-xl-3 col-sm-4 ">
                  <label for="validationCustom01" class="mb-0">Nombre del Producto:</label>
                </div>
                <div class="col-xl-8 col-sm-7">
                  <input class="form-control" id="validationCustom01" type="text"
                    [formControl]="productoForm.controls['name']" required>
                </div>
              </div>

              <div class="form-group row">
                <div class="col-xl-3 col-sm-4 ">
                  <label for="validationCustom01" class="mb-0">Descripción del Producto:</label>
                </div>
                <div class="col-xl-8 col-sm-7">
                  <input class="form-control" id="validationCustom01" type="text"
                    [formControl]="productoForm.controls['description']" required>
                </div>
              </div>

              <div class="form-group row">
                <div class="col-xl-3 col-sm-4 ">
                  <label for="validationCustom01" class="mb-0">Precio del Producto:</label>
                </div>
                <div class="col-xl-8 col-sm-7">
                  <input class="form-control" id="validationCustom01" type="number"
                    [formControl]="productoForm.controls['price']" required>
                </div>
              </div>

              <div class="col-xl-8 col-sm-7">
                <app-color-picker (colorSelected)="onColorSelected($event)"></app-color-picker>
              </div>

              <div class="mb-3" *ngFor="let variante of variantes.controls; let i = index" [formGroupName]="i"
                style="border: 1px solid #d2d6de;">
                <div class="form-group row mt-2">
                  <label class="col-xl-3 col-md-4">Talla:</label>
                  <div class="col-xl-8 col-sm-7">
                    <input class="form-control" formControlName="talla" type="text" required>
                  </div>
                </div>

                <div class="form-group row">
                  <div class="col-xl-3 col-sm-4 ">
                    <label for="validationCustom01" class="mb-0">Stock:</label>
                  </div>
                  <div class="col-xl-8 col-sm-7">
                    <input class="form-control" id="validationCustom01" type="number" formControlName="stock" required
                      [min]="1">
                  </div>
                </div>
                <button type="button" class="btn btn-danger mb-2" (click)="removeVariante(i)"><i
                    class="fa fa-trash-o"></i></button>
              </div>

              <button type="button" class="btn btn-secondary mb-3 mt-3" (click)="addVariante()">Agregar
                Variante</button>
            </div>
          </div>

          <div *ngIf="!isRopaOrZapatos" class="add-product-form">
            <div class="form-group row">
              <div class="col-xl-3 col-sm-4 ">
                <label for="validationCustom01" class="mb-0">Nombre del Producto:</label>
              </div>
              <div class="col-xl-8 col-sm-7">
                <input class="form-control" id="validationCustom01" type="text"
                  [formControl]="productoForm.controls['name']" required>
              </div>
            </div>

            <div class="form-group row">
              <div class="col-xl-3 col-sm-4 ">
                <label for="validationCustom01" class="mb-0">Descripción del Producto:</label>
              </div>
              <div class="col-xl-8 col-sm-7">
                <input class="form-control" id="validationCustom01" type="text"
                  [formControl]="productoForm.controls['description']" required>
              </div>
            </div>

            <div class="form-group row">
              <div class="col-xl-3 col-sm-4 ">
                <label for="validationCustom01" class="mb-0">Precio del Producto:</label>
              </div>
              <div class="col-xl-8 col-sm-7">
                <input class="form-control" id="validationCustom01" type="number"
                  [formControl]="productoForm.controls['price']" required>
              </div>
            </div>

            <div class="form-group row">
              <div class="col-xl-3 col-sm-4 ">
                <label for="validationCustom01" class="mb-0">Stock:</label>
              </div>
              <div class="col-xl-8 col-sm-7">
                <input class="form-control" id="validationCustom01" type="number"
                  [formControl]="productoForm.controls['stock']" required [min]="1">
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" (click)="goToPreviousStep()">Anterior</button>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Container-fluid Ends-->